<!-- PANTALLA INICIAL -->
@if (!juegoIniciado) {
  <div class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center">

    <div class="bg-neutral text-neutral-content
                p-8 rounded-xl shadow-2xl
                max-w-md text-center">

      <h2 class="text-2xl font-mono text-warning mb-4">
        CANAL INTERVENIDO
      </h2>

      <p class="text-sm leading-relaxed mb-6">
        La señal está oculta entre interferencias.<br><br>

        Deberás <strong>ajustar manualmente la frecuencia</strong>
        hasta estabilizar la transmisión y obtener el siguiente número.<br><br>

        <span class="text-error font-semibold">
          Un ajuste impreciso romperá la sintonía.
        </span><br><br>

        <span class="text-info font-semibold">
          Una vez encontrada la señal, mantén la frecuencia estable durante {{ tiempoSintonizacionMs / 1000 }} segundos.
        </span>
      </p>

      <button
        class="btn btn-warning btn-lg w-full"
        (click)="iniciarRadio()">
        INICIAR SINTONIZACIÓN
      </button>

    </div>
  </div>
}


<!-- Audio de estática -->
<audio #audioPlayer src="assets/audio/radio-static.mp3" loop></audio>

<div class="flex flex-col items-center justify-center min-h-screen bg-black p-4">
  <div class="w-full max-w-sm bg-[#22170f] rounded-xl shadow-2xl p-6">

    <h2 class="text-white text-center text-xl uppercase mb-6 tracking-widest">
      SINTONIZADOR
    </h2>

    <!-- Pantalla -->
    <div [ngClass]="pantallaClasses">

      <!-- Estática -->
      <div
        class="absolute inset-0 z-10 pointer-events-none bg-cover"
        [style.opacity]="opacidadEstatica"
        style="background-image: url('https://media.giphy.com/media/oEI9uBYSzLpBK/giphy.gif')">
      </div>

      <!-- Contenido -->
      <div class="flex flex-col justify-center items-center h-full font-mono text-amber-500">

        @if (isFlashing) {
          <p class="text-sm">SEÑAL DECODIFICADA</p>
          <div class="text-7xl mt-2 font-bold animate-pulse text-white">
            1
          </div>
        } @else {
          <p class="text-sm">{{ mensajePantalla }}</p>
          <div class="text-4xl mt-2">
            ---
          </div>
        }

      </div>
    </div>

    <!-- Dial -->
    <div class="w-full px-2 mt-6">
      <input
        type="range"
        min="88"
        max="108"
        step="0.1"
        [(ngModel)]="frecuenciaActual"
        (input)="comprobarSintonizacion()"
        class="range range-warning range-lg w-full"
        [disabled]="!juegoIniciado"
      />

      @if (porcentajeSintonizado > 0 && !pruebaCompletada) {
        <progress
          class="progress progress-warning w-full mt-4"
          [value]="porcentajeSintonizado"
          max="100">
        </progress>
      }

      <div class="flex justify-between w-full px-1 text-xs mt-2 text-gray-400">
        <span>88 MHz</span>
        <span class="text-white text-lg font-mono">
          {{ frecuenciaActual }} MHz
        </span>
        <span>108 MHz</span>
      </div>
    </div>

    <!-- Botón continuar -->
    <div class="mt-8">
      @if (pruebaCompletada) {
        <button
          class="btn btn-warning btn-block shadow-md hover:shadow-lg transition-shadow"
          (click)="audioPlayerRef.nativeElement.pause()">
          He memorizado el código, continuar
        </button>
      } @else {
        <button
          class="btn btn-warning btn-block btn-outline opacity-50"
          disabled>
          Mueve el dial para encontrar la señal...
        </button>
      }
    </div>

  </div>
</div>
@if (mostrarTransicion) {
  <div class="fixed inset-0 bg-black/80 z-50 flex items-center justify-center">
    <div class="text-center animate-fade-in max-w-sm px-6">

      <img
        [src]="imagenPerro"
        alt="Mensaje especial"
        class="rounded-xl shadow-2xl mb-6 mx-auto"
      />

       <p class="text-success font-mono tracking-widest mb-6">
        {{ mensajePerro }}
      </p>

      <button class="btn btn-success btn-wide" (click)="continuar()">
        Continuar
      </button>

    </div>
  </div>
}

